{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user within a tenant.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "tenantId": {
          "type": "string",
          "description": "Reference to Tenant. (Relationship: Tenant 1:N User)"
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "User's first name."
        },
        "lastName": {
          "type": "string",
          "description": "User's last name."
        },
        "subscriptionId": {
          "type": "string",
          "description": "Reference to Subscription. (Relationship: Subscription 1:N User)"
        },
        "roles": {
          "type": "array",
          "description": "User's roles",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "tenantId",
        "email"
      ]
    },
    "Tenant": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Tenant",
      "type": "object",
      "description": "Represents a company or organization using the ERP system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the tenant."
        },
        "name": {
          "type": "string",
          "description": "Name of the tenant."
        },
        "domain": {
          "type": "string",
          "description": "Domain name associated with the tenant."
        },
        "subscriptionId": {
          "type": "string",
          "description": "Reference to Subscription. (Relationship: Subscription 1:N Tenant)"
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "Transaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Transaction",
      "type": "object",
      "description": "Represents a financial transaction.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the transaction."
        },
        "tenantId": {
          "type": "string",
          "description": "Reference to Tenant. (Relationship: Tenant 1:N Transaction)"
        },
        "date": {
          "type": "string",
          "description": "Date of the transaction.",
          "format": "date-time"
        },
        "amount": {
          "type": "number",
          "description": "Amount of the transaction."
        },
        "type": {
          "type": "string",
          "description": "Type of transaction (e.g., 'sale', 'purchase')."
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N Transaction)"
        }
      },
      "required": [
        "id",
        "tenantId",
        "date",
        "amount",
        "type"
      ]
    },
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a product or service.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the product."
        },
        "tenantId": {
          "type": "string",
          "description": "Reference to Tenant. (Relationship: Tenant 1:N Product)"
        },
        "name": {
          "type": "string",
          "description": "Name of the product."
        },
        "description": {
          "type": "string",
          "description": "Description of the product."
        },
        "price": {
          "type": "number",
          "description": "Price of the product."
        }
      },
      "required": [
        "id",
        "tenantId",
        "name",
        "price"
      ]
    },
    "Plan": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Plan",
      "type": "object",
      "description": "Represents a subscription plan.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the plan."
        },
        "name": {
          "type": "string",
          "description": "Name of the plan (e.g., 'Free', 'Standard')."
        },
        "price": {
          "type": "number",
          "description": "Price of the plan."
        },
        "features": {
          "type": "array",
          "description": "Features included in the plan.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "name",
        "price"
      ]
    },
    "Subscription": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Subscription",
      "type": "object",
      "description": "Represents a user subscription to a particular plan.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the subscription."
        },
        "planId": {
          "type": "string",
          "description": "Reference to Plan. (Relationship: Plan 1:N Subscription)"
        },
        "startDate": {
          "type": "string",
          "description": "Date when the subscription started.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "Date when the subscription ends.",
          "format": "date-time"
        },
        "tenantId": {
          "type": "string",
          "description": "Reference to Tenant. (Relationship: Tenant 1:N Subscription)"
        }
      },
      "required": [
        "id",
        "planId",
        "startDate",
        "endDate"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/tenants/{tenantId}",
        "definition": {
          "entityName": "Tenant",
          "schema": {
            "$ref": "#/backend/entities/Tenant"
          },
          "description": "Collection to store tenant information. Each document represents a tenant.",
          "params": [
            {
              "name": "tenantId",
              "description": "Unique identifier for the tenant."
            }
          ]
        }
      },
      {
        "path": "/tenants/{tenantId}/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Collection to store user information for a specific tenant. Includes the denormalized 'tenantId' for authorization independence.",
          "params": [
            {
              "name": "tenantId",
              "description": "Unique identifier for the tenant."
            },
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/tenants/{tenantId}/transactions/{transactionId}",
        "definition": {
          "entityName": "Transaction",
          "schema": {
            "$ref": "#/backend/entities/Transaction"
          },
          "description": "Collection to store transaction information for a specific tenant. Includes the denormalized 'tenantId' for authorization independence.",
          "params": [
            {
              "name": "tenantId",
              "description": "Unique identifier for the tenant."
            },
            {
              "name": "transactionId",
              "description": "Unique identifier for the transaction."
            }
          ]
        }
      },
      {
        "path": "/tenants/{tenantId}/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Collection to store product information for a specific tenant. Includes the denormalized 'tenantId' for authorization independence.",
          "params": [
            {
              "name": "tenantId",
              "description": "Unique identifier for the tenant."
            },
            {
              "name": "productId",
              "description": "Unique identifier for the product."
            }
          ]
        }
      },
      {
        "path": "/global/plans/{planId}",
        "definition": {
          "entityName": "Plan",
          "schema": {
            "$ref": "#/backend/entities/Plan"
          },
          "description": "Collection to store global subscription plan information, accessible to all tenants.",
          "params": [
            {
              "name": "planId",
              "description": "Unique identifier for the subscription plan."
            }
          ]
        }
      }
    ],
    "reasoning": "This design implements a multi-tenant Firestore structure where data is segregated under `/tenants/{tenantId}`. This approach provides a clear separation of data between different tenants, simplifying security rules and enhancing scalability. Each tenant has its own collections for users, transactions, and products. A global collection `/global/plans` stores subscription plans accessible to all tenants.\n\nAuthorization Independence:\n\n*   Each document under `/tenants/{tenantId}` includes the `tenantId` field. This denormalization allows security rules to verify the tenant context without needing to perform expensive `get()` operations to parent documents. For example, a rule for `/tenants/{tenantId}/users/{userId}` can directly check if `request.auth.uid` exists as a key in the user document's 'roles' map (if roles were stored directly on the User document) or some other field. Alternatively, rules can verify if the user document's 'tenantId' matches the requested `{tenantId}`.\n\nQAPs (Rules are not Filters):\n\n*   The segregation of data into tenant-specific collections ensures that list operations are always performed within a specific tenant's context. Security rules can easily restrict access to resources based on the `tenantId` in the path, preventing unauthorized access to other tenants' data. The global plans collection is explicitly defined for shared resources, allowing for different security rules to be applied as needed. For `list` requests, the rules can simply verify that `request.auth.uid` exists and that the requested `tenantId` matches the user's associated tenant. This avoids filtering and ensures that only authorized data is returned."
  }
}