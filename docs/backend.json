{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user within a tenant.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "tenantId": {
          "type": "string",
          "description": "Reference to Tenant. (Relationship: Tenant 1:N User)"
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "User's first name."
        },
        "lastName": {
          "type": "string",
          "description": "User's last name."
        },
        "subscriptionId": {
          "type": "string",
          "description": "Reference to Subscription. (Relationship: Subscription 1:N User)"
        },
        "role": {
          "type": "string",
          "description": "User's role",
          "enum": ["admin", "cashier", "viewer"]
        }
      },
      "required": [
        "id",
        "tenantId",
        "email",
        "role"
      ]
    },
    "Tenant": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Tenant",
      "type": "object",
      "description": "Represents a company or organization using the ERP system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the tenant."
        },
        "name": {
          "type": "string",
          "description": "Name of the tenant."
        },
        "domain": {
          "type": "string",
          "description": "Domain name associated with the tenant."
        },
        "subscriptionId": {
          "type": "string",
          "description": "Reference to Subscription. (Relationship: Subscription 1:N Tenant)"
        },
        "status": {
          "type": "string",
          "enum": ["active", "inactive", "deleted"],
          "description": "The current status of the tenant."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "Transaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Transaction",
      "type": "object",
      "description": "Represents a financial transaction.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the transaction."
        },
        "tenantId": {
          "type": "string",
          "description": "Reference to Tenant. (Relationship: Tenant 1:N Transaction)"
        },
        "date": {
          "type": "string",
          "description": "Date of the transaction.",
          "format": "date-time"
        },
        "amount": {
          "type": "number",
          "description": "Amount of the transaction."
        },
        "type": {
          "type": "string",
          "description": "Type of transaction (e.g., 'sale', 'purchase')."
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N Transaction)"
        },
        "signature": {
          "type": "string",
          "description": "RKSV signature for the transaction."
        },
        "qrCode": {
          "type": "string",
          "description": "RKSV QR code data for the transaction."
        },
        "source": {
          "type": "string",
          "description": "Source of the transaction (e.g., 'pos-shop', 'wolt', 'foodora')."
        },
        "status": {
          "type": "string",
          "description": "Status of the transaction (e.g., 'pending', 'completed', 'paid')."
        }
      },
      "required": [
        "id",
        "tenantId",
        "date",
        "type"
      ]
    },
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a product or service.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the product."
        },
        "tenantId": {
          "type": "string",
          "description": "Reference to Tenant. (Relationship: Tenant 1:N Product)"
        },
        "name": {
          "type": "string",
          "description": "Name of the product."
        },
        "description": {
          "type": "string",
          "description": "Description of the product."
        },
        "price": {
          "type": "number",
          "description": "Price of the product."
        },
        "quantity": {
            "type": "number",
            "description": "The current stock quantity of the product."
        }
      },
      "required": [
        "id",
        "tenantId",
        "name",
        "price"
      ]
    },
    "Plan": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Plan",
      "type": "object",
      "description": "Represents a subscription plan.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the plan."
        },
        "name": {
          "type": "string",
          "description": "Name of the plan (e.g., 'Free', 'Standard')."
        },
        "price": {
          "type": "number",
          "description": "Price of the plan."
        },
        "features": {
          "type": "array",
          "description": "Features included in the plan.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "name",
        "price"
      ]
    },
    "Subscription": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Subscription",
      "type": "object",
      "description": "Represents a user subscription to a particular plan.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the subscription."
        },
        "planId": {
          "type": "string",
          "description": "Reference to Plan. (Relationship: Plan 1:N Subscription)"
        },
        "startDate": {
          "type": "string",
          "description": "Date when the subscription started.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "Date when the subscription ends.",
          "format": "date-time"
        },
        "tenantId": {
          "type": "string",
          "description": "Reference to Tenant. (Relationship_ Tenant 1:N Subscription)"
        }
      },
      "required": [
        "id",
        "planId",
        "startDate",
        "endDate"
      ]
    },
    "UserTenant": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserTenant",
      "type": "object",
      "description": "Maps a user's UID to their tenant ID.",
      "properties": {
        "tenantId": {
          "type": "string",
          "description": "The ID of the tenant the user belongs to."
        }
      },
      "required": [
        "tenantId"
      ]
    },
    "Settings": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Settings",
      "type": "object",
      "description": "Represents tenant-specific settings.",
      "properties": {
        "companyName": {
          "type": "string",
          "description": "The name of the company."
        },
        "themeColor": {
          "type": "string",
          "description": "The primary color for the UI theme."
        }
      }
    },
    "ModuleSettings": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Module Settings",
      "type": "object",
      "description": "Represents the enabled/disabled state of various application modules for a tenant.",
      "properties": {
        "posShop": {
          "type": "boolean",
          "description": "Point of Sale (Shop)"
        },
        "posRestaurant": {
          "type": "boolean",
          "description": "Point of Sale (Restaurant)"
        },
        "calendar": {
          "type": "boolean",
          "description": "Calendar Module"
        },
        "kiosk": {
          "type": "boolean",
          "description": "Kiosk Mode"
        },
        "aiAssistant": {
          "type": "boolean",
          "description": "AI Assistant"
        }
      }
    },
    "AutomationRules": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Automation Rules",
      "type": "object",
      "description": "Configurable rules for the automation worker.",
      "properties": {
        "highOrderVolumeThreshold": {
          "type": "number",
          "description": "Transaction count in the last 10 mins to trigger a high volume alert."
        },
        "lowStockThreshold": {
          "type": "number",
          "description": "The stock quantity below which a low stock alert is triggered."
        },
        "integrationTimeoutMinutes": {
          "type": "number",
          "description": "The number of minutes after which an inactive integration triggers an alert."
        },
        "dailySummaryEnabled": {
          "type": "boolean",
          "description": "Whether to send the daily summary notification."
        }
      }
    },
    "ChatMessage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ChatMessage",
      "type": "object",
      "description": "Represents a single message in an AI chat.",
      "properties": {
        "text": {
          "type": "string",
          "description": "The content of the message."
        },
        "role": {
          "type": "string",
          "description": "The role of the message sender.",
          "enum": [
            "user",
            "model"
          ]
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "The time the message was sent."
        }
      },
      "required": [
        "text",
        "role",
        "timestamp"
      ]
    },
    "RKSVKey": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "RKSV Key",
      "type": "object",
      "description": "Represents the RKSV signing key information for a tenant.",
      "properties": {
        "publicKey": {
          "type": "string",
          "description": "The public key for transaction signature verification."
        },
        "rksvActive": {
          "type": "boolean",
          "description": "Flag indicating if RKSV signing is active for the tenant."
        },
        "lastSignature": {
          "type": "string",
          "description": "The signature of the most recent transaction, used for chaining."
        }
      },
      "required": [
        "publicKey",
        "rksvActive",
        "lastSignature"
      ]
    },
    "Integration": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Integration",
      "type": "object",
      "description": "Stores credentials and status for a third-party integration.",
      "properties": {
        "apiKey": {
          "type": "string",
          "description": "Encrypted API key for the third-party service."
        },
        "connectedAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp when the integration was connected."
        },
        "lastSync": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp of the last successful data sync."
        },
        "status": {
          "type": "string",
          "enum": [
            "active",
            "disconnected",
            "error"
          ],
          "description": "The current status of the integration."
        }
      },
      "required": [
        "apiKey",
        "connectedAt",
        "status"
      ]
    },
    "POSOrder": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "POS Order",
      "type": "object",
      "description": "Represents an order originating from an external Point-of-Sale or delivery platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order, usually from the external platform."
        },
        "tenantId": {
          "type": "string",
          "description": "The tenant this order belongs to."
        },
        "customer": {
          "type": "object",
          "description": "Customer information."
        },
        "items": {
          "type": "array",
          "description": "The items included in the order."
        },
        "totalAmount": {
          "type": "number",
          "description": "The total amount of the order."
        },
        "paymentType": {
          "type": "string",
          "description": "How the order was paid (e.g., 'card', 'cash_on_delivery')."
        },
        "source": {
          "type": "string",
          "description": "The platform the order originated from (e.g., 'wolt', 'foodora')."
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp of when the order was placed."
        }
      },
      "required": [
        "id",
        "tenantId",
        "totalAmount",
        "source",
        "timestamp"
      ]
    },
    "AuditLog": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Audit Log",
      "type": "object",
      "description": "Logs an incoming API call from an external platform.",
      "properties": {
        "platform": {
          "type": "string",
          "description": "The originating platform (e.g., 'wolt')."
        },
        "endpoint": {
          "type": "string",
          "description": "The specific webhook endpoint that was hit."
        },
        "receivedAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp of when the webhook was received."
        },
        "payloadHash": {
          "type": "string",
          "description": "A SHA256 hash of the incoming payload for verification."
        },
        "status": {
            "type": "string",
            "enum": ["success", "failed"],
            "description": "The outcome of processing the webhook."
        }
      },
      "required": ["platform", "receivedAt", "payloadHash", "status"]
    },
    "Notification": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Notification",
      "type": "object",
      "description": "Represents a notification for a user within a tenant.",
      "properties": {
        "title": {
          "type": "string",
          "description": "The title of the notification."
        },
        "message": {
          "type": "string",
          "description": "The main content of the notification."
        },
        "type": {
          "type": "string",
          "enum": ["info", "alert", "success", "insight"],
          "description": "The type of notification, which can be used for styling."
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "When the notification was created."
        },
        "read": {
          "type": "boolean",
          "description": "Whether the notification has been read by the user."
        }
      },
      "required": ["title", "message", "type", "timestamp", "read"]
    },
    "Mail": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Mail",
      "type": "object",
      "description": "Represents an email to be sent by an extension.",
      "properties": {
        "to": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Array of recipient email addresses."
        },
        "message": {
          "type": "object",
          "properties": {
            "subject": { "type": "string" },
            "html": { "type": "string" }
          },
          "required": ["subject", "html"]
        }
      },
      "required": ["to", "message"]
    },
    "Payment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Payment",
      "type": "object",
      "description": "Represents a payment for a transaction.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the payment."
        },
        "tenantId": {
          "type": "string",
          "description": "Reference to the Tenant."
        },
        "transactionId": {
          "type": "string",
          "description": "Reference to the Transaction."
        },
        "method": {
          "type": "string",
          "enum": ["cash", "card", "stripe", "bankomat"],
          "description": "Payment method used."
        },
        "amount": {
          "type": "number",
          "description": "Amount paid."
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp of the payment."
        },
        "status": {
          "type": "string",
          "enum": ["completed", "failed", "pending"],
          "description": "Status of the payment."
        }
      },
      "required": ["id", "tenantId", "transactionId", "method", "amount", "timestamp", "status"]
    },
    "StripePaymentIntent": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Stripe Payment Intent",
      "type": "object",
      "description": "Response from creating a Stripe Payment Intent.",
      "properties": {
        "clientSecret": {
          "type": "string",
          "description": "The client secret for the Stripe Payment Intent."
        }
      },
      "required": ["clientSecret"]
    }
  },
  "auth": {
    "providers": [
      "password"
    ]
  },
  "firestore": {
    "/users/{userId}": {
      "schema": {
        "$ref": "#/entities/UserTenant"
      },
      "description": "Top-level collection to map user UIDs to tenant IDs for security rules."
    },
    "/tenants/{tenantId}": {
      "schema": {
        "$ref": "#/entities/Tenant"
      },
      "description": "Collection to store tenant information."
    },
    "/tenants/{tenantId}/users/{userId}": {
      "schema": {
        "$ref": "#/entities/User"
      },
      "description": "Sub-collection for users within a tenant."
    },
    "/tenants/{tenantId}/transactions/{transactionId}": {
      "schema": {
        "$ref": "#/entities/Transaction"
      },
      "description": "Sub-collection for transactions within a tenant."
    },
    "/tenants/{tenantId}/payments/{paymentId}": {
      "schema": {
        "$ref": "#/entities/Payment"
      },
      "description": "Sub-collection for payments within a tenant."
    },
    "/tenants/{tenantId}/products/{productId}": {
      "schema": {
        "$ref": "#/entities/Product"
      },
      "description": "Sub-collection for products within a tenant."
    },
    "/tenants/{tenantId}/settings/general": {
      "schema": {
        "$ref": "#/entities/Settings"
      },
      "description": "Document for general settings within a tenant."
    },
    "/tenants/{tenantId}/settings/modules": {
      "schema": {
        "$ref": "#/entities/ModuleSettings"
      },
      "description": "Document for module settings within a tenant."
    },
    "/tenants/{tenantId}/settings/automationRules": {
        "schema": {
            "$ref": "#/entities/AutomationRules"
        },
        "description": "Document for automation rule settings within a tenant."
    },
    "/tenants/{tenantId}/settings/rksv": {
      "schema": {
        "$ref": "#/entities/RKSVKey"
      },
      "description": "Document for RKSV key and status within a tenant."
    },
    "/tenants/{tenantId}/integrations/{platformId}": {
      "schema": {
        "$ref": "#/entities/Integration"
      },
      "description": "Stores credentials and status for third-party integrations like Wolt or Foodora."
    },
    "/global/plans/{planId}": {
      "schema": {
        "$ref": "#/entities/Plan"
      },
      "description": "Global collection for subscription plans."
    },
    "/tenants/{tenantId}/aiChats/{chatId}/messages/{messageId}": {
      "schema": {
        "$ref": "#/entities/ChatMessage"
      },
      "description": "Sub-collection for messages within an AI chat session."
    },
    "/tenants/{tenantId}/posOrders/{orderId}": {
      "schema": {
        "$ref": "#/entities/POSOrder"
      },
      "description": "Sub-collection for orders from external POS/delivery platforms."
    },
    "/tenants/{tenantId}/auditLogs/{logId}": {
        "schema": {
            "$ref": "#/entities/AuditLog"
        },
        "description": "Sub-collection for logging incoming webhook API calls."
    },
    "/tenants/{tenantId}/notifications/{notificationId}": {
      "schema": {
        "$ref": "#/entities/Notification"
      },
      "description": "Sub-collection for user and system notifications within a tenant."
    },
    "/mail/{mailId}": {
      "schema": {
        "$ref": "#/entities/Mail"
      },
      "description": "Collection for triggering email sending via Firebase Extensions (e.g., SendGrid, Mailgun)."
    }
  }
}
